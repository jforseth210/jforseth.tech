<!DOCTYPE html>
<html>

<head>
    <title>Counter</title>
    <link rel='stylesheet' href='/static/index.css' type='text/css' />
    <link rel='stylesheet' href='/static/barrel_racing/barrel_racing.css' type='text/css' />
</head>

<body>
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <!--Alerts from https://www.w3schools.com/howto/howto_js_alert.asp-->
                <div class="alert {{category}}">
                    <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
                    {{message}}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    <p>{{error}}</p>
    <h1>Horse #</h1>
    <form id=currentnumberform action="/barrelracing/current_number_update" method="POST">
        <input name=current_number id=current_number value={{current_number}} />
        <input type=submit class="invisible" />
    </form>
    <h1>is currently running</h1>
    <div id=formparent>
        
        <form id=plusform action="/barrelracing/current_number_update" method="POST">
            <input type=number name=current_number id=plushidden class=invisible value={%if current_number != "ERROR"%}{{ current_number + 1 }}{%endif%} />
            <input type=submit id=plus class=button value=+>
        </form>
        <form id=minusform action="/barrelracing/current_number_update" method="POST">
            <input type=number name=current_number id=minushidden class=invisible value={%if current_number != "ERROR"%}{{ current_number - 1 }}{%endif%} />
            <input type=submit id=minus class=button value=->
        </form>
    </div>
    <script>
        //I stole, ahem, borrowed this from https://stackoverflow.com/questions/12232304/how-to-implement-server-push-in-flask-framework
        var current_number = document.getElementById("current_number");
        var plushidden = document.getElementById("plushidden");
        var minushidden = document.getElementById("minushidden");
        var eventSource = new EventSource("/barrelracing/stream")
        eventSource.onmessage = function (e) {
            if (current_number != document.activeElement) {
                current_number.value = e.data;
                plushidden.value=Number(e.data)+1;
                minushidden.value=Number(e.data)-1;
            }
        };
    </script>
    <!--W3Schools-->
    <script>
            // Get all elements with class="closebtn"
            var close = document.getElementsByClassName("closebtn");
            var i;
    
            // Loop through all close buttons
            for (i = 0; i < close.length; i++) {
                // When someone clicks on a close button
                close[i].onclick = function () {
    
                    // Get the parent of <span class="closebtn"> (<div class="alert">)
                    var div = this.parentElement;
    
                    // Set the opacity of div to 0 (transparent)
                    div.style.opacity = "0";
    
                    // Hide the div after 600ms (the same amount of milliseconds it takes to fade out)
                    setTimeout(function () { div.style.display = "none"; }, 600);
                }
            }
        </script>
        <!--End W3schools-->
</body>

</html>